<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
<title>ë§ˆì´ì›Œì¹˜</title>
<link rel="manifest" id="manifest-placeholder">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black">
<link rel="apple-touch-icon" href="A47A3114-D5FA-4034-A494-F38D0538512F.png">
<style>
:root{
--bg:#101014;--soft:#1a1a1f;--glass:rgba(255,255,255,0.05);
--border:rgba(255,255,255,0.12);--inner:inset 0 0 4px rgba(255,255,255,0.12);
--outer:0 3px 8px rgba(0,0,0,0.45);--radius:6px;--text:#fff;
--sub:#b6b6b6;--accent:#3b7bff;--income:#3be0ff;--expense:#ff3b3b;
}
html,body{margin:0;height:100%;overflow:hidden;font-family:-apple-system,BlinkMacSystemFont,"SF Pro",Inter,Roboto,sans-serif;color:var(--text);background:var(--bg);}
.app{max-width:1000px;margin:0 auto;padding:18px;height:100%;display:flex;flex-direction:column;}
header{display:flex;justify-content:space-between;align-items:center;margin-bottom:10px;}
h1{margin:0;font-size:20px;font-weight:600;}
.small{color:var(--sub);font-size:13px;}
.btn{padding:8px 10px;border-radius:var(--radius);border:1px solid var(--border);background:var(--glass);color:var(--text);cursor:pointer;box-shadow:var(--inner),var(--outer);}
.btn:hover{background:rgba(255,255,255,0.08);}
.btn:active{transform:scale(.97);}
.btn.ghost{background:transparent !important;}
.btn.white{color:#fff;}
.sq{background:var(--glass);border:1px solid var(--border);border-radius:var(--radius);box-shadow:var(--inner),var(--outer);backdrop-filter:blur(16px);}
input[type=text],input[type=number],input[type=date],input[type=file],textarea,select{width:100%;padding:8px;border-radius:var(--radius);background:var(--glass);border:1px solid var(--border);color:var(--text);box-shadow:var(--inner);font-size:16px;}
textarea{resize:none;}
.categories,.brand-list,.watch-list,.account-history-list{display:flex;flex-wrap:wrap;gap:12px;margin-top:14px;}
.cat,.brand-card,.watch-item,.account-item{flex:1 1 150px;min-width:150px;padding:12px;cursor:pointer;}
.brand-image,.watch-img{width:100%;height:120px;border-radius:var(--radius);object-fit:cover;background:#0003;}
main section{display:none;height:100%;overflow:hidden;flex-direction:column;} 
main section.active{display:flex;}
.fab{position:fixed;right:20px;bottom:20px;width:56px;height:56px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:28px;background:var(--glass);box-shadow:var(--inner),var(--outer);cursor:pointer;z-index:999;}
#account-history{flex-grow:1;overflow-y:auto;margin-bottom:10px;}
.account-item{display:flex;flex-direction:column;gap:4px;}
.account-buttons{display:flex;gap:6px;}
</style>
</head>
<body>
<div class="app">
<header>
  <div><h1>ë§ˆì´ì›Œì¹˜</h1><div class="small">Created by jjun</div></div>
  <div id="nav-actions">
    <button class="btn white" onclick="showAccount()">ğŸ’°</button>
    <button class="btn white" onclick="refreshPage()">âŸ³</button>
  </div>
</header>

<main>
<!-- í™ˆ -->
<section id="page-main" class="active">
  <div class="small">ì¹´í…Œê³ ë¦¬ë¥¼ ì„ íƒí•˜ì„¸ìš”</div>
  <div class="categories" id="categories-root"></div>
</section>

<!-- ì¹´í…Œê³ ë¦¬ -->
<section id="page-category">
  <div style="display:flex;align-items:center;gap:8px;margin-bottom:10px;">
    <button class="btn ghost" onclick="goBack()">â†</button>
    <strong id="category-title"></strong>
  </div>
  <input type="text" id="brand-search" placeholder="ë¸Œëœë“œ ê²€ìƒ‰" oninput="renderBrandList()">
  <div class="brand-list" id="brand-list"></div>
  <div class="fab" onclick="goAddBrand()">ï¼‹</div>
</section>

<!-- ë¸Œëœë“œ -->
<section id="page-brand">
  <div style="display:flex;align-items:center;gap:8px;margin-bottom:10px;">
    <button class="btn ghost" onclick="goBack()">â†</button>
    <strong id="brand-title"></strong>
  </div>
  <input type="text" id="watch-search" placeholder="ì‹œê³„ ê²€ìƒ‰" oninput="renderWatchList()">
  <div class="watch-list" id="watch-list"></div>
  <div class="fab" onclick="goAddWatch()">ï¼‹</div>
</section>

<!-- ì‹œê³„ ì¶”ê°€ -->
<section id="page-add-watch">
  <div style="display:flex;align-items:center;gap:8px;margin-bottom:10px;">
    <button class="btn ghost" onclick="goBack()">â†</button>
    <strong>ì‹œê³„ ì¶”ê°€</strong>
  </div>
  <input type="text" id="new-watch-name" placeholder="ì‹œê³„ ì´ë¦„">
  <input type="file" id="new-watch-img" accept="image/*">
  <button class="btn" onclick="addWatchFromPage()">ì¶”ê°€</button>
</section>

<!-- ë¸Œëœë“œ ì¶”ê°€ -->
<section id="page-add-brand">
  <div style="display:flex;align-items:center;gap:8px;margin-bottom:10px;">
    <button class="btn ghost" onclick="goBack()">â†</button>
    <strong>ë¸Œëœë“œ ì¶”ê°€</strong>
  </div>
  <input type="text" id="new-brand-name" placeholder="ë¸Œëœë“œ ì´ë¦„">
  <input type="file" id="new-brand-img" accept="image/*">
  <button class="btn" onclick="addBrandFromPage()">ì¶”ê°€</button>
</section>

<!-- ê°€ê³„ë¶€ -->
<section id="page-account">
  <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:10px;">
    <button class="btn ghost" onclick="goBack()">â†</button>
    <strong>ê°€ê³„ë¶€</strong>
    <div>
      <button class="btn" onclick="prevMonth()">â—€</button>
      <button class="btn" onclick="nextMonth()">â–¶</button>
    </div>
  </div>
  <div id="account-month-total" style="text-align:center;font-weight:600;margin-bottom:10px;"></div>
  <div id="weekday-row" style="display:flex;gap:6px;justify-content:space-between;margin-bottom:6px;"></div>
  <div id="account-history"></div>
  <div style="display:flex;justify-content:space-between;gap:8px;position:sticky;bottom:0;background:var(--bg);padding-top:4px;">
    <button class="btn" onclick="showAccountByType('expense')" id="sum-expense"></button>
    <button class="btn" onclick="showAccountByType('income')" id="sum-income"></button>
    <div id="sum-final" style="font-weight:600"></div>
  </div>
  <div class="fab" onclick="openAccountPopup()">ï¼‹</div>
</section>
</main>

<!-- ëª¨ë‹¬ -->
<div id="modal" style="position:fixed;top:0;left:0;width:100%;height:100%;display:none;align-items:center;justify-content:center;background:rgba(0,0,0,0.4);backdrop-filter:blur(6px);z-index:999;">
  <div id="modal-card" class="sq" style="max-width:400px;width:90%;padding:16px;"></div>
</div>

<script>
// ===== ë°ì´í„° =====
let categories = JSON.parse(localStorage.getItem("MW_data")||"null");
if(!categories) categories=[{name:"ë³´ìœ ",brands:[]},{name:"ë¯¸ë³´ìœ ",brands:[]},{name:"ì¶”ì–µ",brands:[]}];
let accounts = JSON.parse(localStorage.getItem("MW_accounts")||"[]");
let currentCategoryIndex=null,currentBrandIndex=null,pageStack=[];
let currentMonth = new Date().getMonth();
let currentYear = new Date().getFullYear();

function save(){localStorage.setItem("MW_data",JSON.stringify(categories));}
function saveAccounts(){localStorage.setItem("MW_accounts",JSON.stringify(accounts));}

// ===== í˜ì´ì§€ ì „í™˜ =====
function showPage(id){document.querySelectorAll("main section").forEach(sec=>sec.classList.remove("active"));document.getElementById(id).classList.add("active");if(pageStack[pageStack.length-1]!==id) pageStack.push(id);}
function goBack(){if(pageStack.length>1){pageStack.pop();showPage(pageStack[pageStack.length-1]);}else showMain();}
function refreshPage(){location.reload();}

// ===== í™ˆ =====
function renderMain(){
  const root=document.getElementById("categories-root"); root.innerHTML="";
  categories.forEach((cat,i)=>{
    const watchCount=cat.brands.reduce((a,b)=>a+b.watches.length,0);
    const el=document.createElement("div"); el.className="sq cat";
    el.innerHTML=`<h2>${cat.name}</h2><p>${cat.brands.length}ê°œ ë¸Œëœë“œ, ${watchCount}ê°œ ì‹œê³„</p>`;
    el.onclick=()=>showCategory(i);
    root.appendChild(el);
  });
}
function showMain(){currentCategoryIndex=null;showPage("page-main");}
renderMain();

// ===== ì¹´í…Œê³ ë¦¬/ë¸Œëœë“œ =====
function showCategory(i){currentCategoryIndex=i;document.getElementById("category-title").textContent=categories[i].name;document.getElementById("brand-search").value="";renderBrandList();showPage("page-category");}
function renderBrandList(){
  const wrap=document.getElementById("brand-list");wrap.innerHTML="";
  const q=document.getElementById("brand-search").value.toLowerCase();
  categories[currentCategoryIndex].brands.forEach((b,bi)=>{
    if(q&&!b.name.toLowerCase().includes(q)) return;
    const card=document.createElement("div"); card.className="sq brand-card";
    card.innerHTML=`<img src="${b.img}" class="brand-image"><div style="display:flex;justify-content:space-between;"><div><div class="brand-name">${b.name}</div><div class="small">${b.watches.length}ê°œ ì‹œê³„</div></div><div style="display:flex;flex-direction:column;gap:6px;"><button class="btn" onclick="showBrand(${bi})">ì—´ê¸°</button><button class="btn ghost" onclick="deleteBrand(${bi})">ì‚­ì œ</button></div></div>`;
    wrap.appendChild(card);
  });
}
function goAddBrand(){showPage("page-add-brand");}
function addBrandFromPage(){
  const name=document.getElementById("new-brand-name").value.trim(); const file=document.getElementById("new-brand-img").files[0];
  if(!name){alert("ë¸Œëœë“œëª…ì„ ì…ë ¥í•˜ì„¸ìš”");return;}
  const fr=new FileReader();
  fr.onload=e=>{categories[currentCategoryIndex].brands.push({name,img:e.target.result,watches:[]});save();renderBrandList();showCategory(currentCategoryIndex);document.getElementById("new-brand-name").value="";document.getElementById("new-brand-img").value=null;};
  if(file) fr.readAsDataURL(file); else fr.onload({target:{result:""}})
}

// ===== ë¸Œëœë“œ/ì‹œê³„ =====
function showBrand(bi){currentBrandIndex=bi;document.getElementById("brand-title").textContent=categories[currentCategoryIndex].brands[bi].name;document.getElementById("watch-search").value="";renderWatchList();showPage("page-brand");}
function renderWatchList(){
  const wrap=document.getElementById("watch-list");wrap.innerHTML="";
  const q=document.getElementById("watch-search").value.toLowerCase();
  categories[currentCategoryIndex].brands[currentBrandIndex].watches.forEach((w,wi)=>{
    if(q&&!w.name.toLowerCase().includes(q)) return;
    const item=document.createElement("div");item.className="sq watch-item";item.innerHTML=`<img src="${w.img}" class="watch-img"><div style="font-weight:600;">${w.name}</div>`;
    wrap.appendChild(item);
  });
}
function goAddWatch(){showPage("page-add-watch");}
function addWatchFromPage(){
  const name=document.getElementById("new-watch-name").value.trim();
  const file=document.getElementById("new-watch-img").files[0];
  if(!name||!file){alert("ì…ë ¥/ì„ íƒ í•„ìš”");return;}
  const fr=new FileReader();
  fr.onload=e=>{
    categories[currentCategoryIndex].brands[currentBrandIndex].watches.push({name,img:e.target.result});
    save(); renderWatchList(); showBrand(currentBrandIndex);
    document.getElementById("new-watch-name").value=""; document.getElementById("new-watch-img").value=null;
  }; fr.readAsDataURL(file);
}

// ===== ê°€ê³„ë¶€: ì „ì²´ ê¸°ëŠ¥ =====
function showAccount(){showPage("page-account");renderAccount();}
function renderAccount(){
  const historyWrap=document.getElementById("account-history"); historyWrap.innerHTML="";
  const monthAccounts = accounts.filter(a=>{const d=new Date(a.date); return d.getMonth()===currentMonth && d.getFullYear()===currentYear;});
  monthAccounts.forEach((a,idx)=>{
    const item=document.createElement("div"); item.className="sq account-item";
    item.innerHTML=`<div><b>${a.type==="expense"?"ì§€ì¶œ":"ìˆ˜ì…"}</b> - ${a.brand||""} ${a.model||""} : ${a.price}ì›</div>
    <div class="account-buttons">
      <button class="btn" onclick="editAccount(${idx})">ìˆ˜ì •</button>
      <button class="btn ghost" onclick="deleteAccount(${idx})">ì‚­ì œ</button>
    </div>`;
    historyWrap.appendChild(item);
  });
  const sumExpense = monthAccounts.filter(a=>a.type==="expense").reduce((s,a)=>s+a.price,0);
  const sumIncome = monthAccounts.filter(a=>a.type==="income").reduce((s,a)=>s+a.price,0);
  document.getElementById("sum-expense").textContent=`ì§€ì¶œ ${sumExpense}ì›`; document.getElementById("sum-expense").style.color="var(--expense)";
  document.getElementById("sum-income").textContent=`ìˆ˜ì… ${sumIncome}ì›`; document.getElementById("sum-income").style.color="var(--income)";
  document.getElementById("sum-final").textContent=`ì´ì•¡ ${sumIncome-sumExpense}ì›`; document.getElementById("sum-final").style.color="var(--text)";
  document.getElementById("account-month-total").textContent=`${currentYear}ë…„ ${currentMonth+1}ì›”`;
}
function openAccountPopup(){
  const modal=document.getElementById("modal"); const card=document.getElementById("modal-card");
  card.innerHTML=`<h3 style="margin-top:0;">ê°€ê³„ë¶€ ì¶”ê°€</h3>
  <div style="display:flex;gap:8px;"><button class="btn" onclick="addAccount('expense')">êµ¬ë§¤</button><button class="btn" onclick="addAccount('income')">íŒë§¤</button></div>
  <div style="margin-top:12px;"><button class="btn ghost" onclick="closeModal()">ì·¨ì†Œ</button></div>`;
  modal.style.display="flex";
}
function addAccount(type){
  const modal=document.getElementById("modal"); const card=document.getElementById("modal-card");
  card.innerHTML=`<h3>${type==="expense"?"êµ¬ë§¤ ì¶”ê°€":"íŒë§¤ ì¶”ê°€"}</h3>
  <input type="number" id="ac-price" placeholder="ê°€ê²©">
  <input type="text" id="ac-store" placeholder="${type==="expense"?"êµ¬ë§¤ì²˜":"íŒë§¤ì²˜"}">
  <input type="date" id="ac-date" placeholder="ë‚ ì§œ">
  <input type="text" id="ac-model" placeholder="ëª¨ë¸ëª…">
  <input type="text" id="ac-brand" placeholder="ë¸Œëœë“œ">
  <textarea id="ac-note" placeholder="ë©”ëª¨"></textarea>
  <div style="display:flex;gap:8px;margin-top:8px;"><button class="btn" onclick="saveAccount('${type}')">ì €ì¥</button>
  <button class="btn ghost" onclick="closeModal()">ì·¨ì†Œ</button></div>`;
}
function saveAccount(type){
  const price=Number(document.getElementById("ac-price").value);
  const store=document.getElementById("ac-store").value;
  const date=document.getElementById("ac-date").value;
  const model=document.getElementById("ac-model").value;
  const brand=document.getElementById("ac-brand").value;
  const note=document.getElementById("ac-note").value;
  if(!price||!date){alert("ê°€ê²©ê³¼ ë‚ ì§œëŠ” í•„ìˆ˜"); return;}
  accounts.push({type,price,store,date,model,brand,note});
  saveAccounts();closeModal();renderAccount();
}
function closeModal(){document.getElementById("modal").style.display="none";}
function deleteAccount(idx){if(confirm("ì‚­ì œ?")){accounts.splice(idx,1);saveAccounts();renderAccount();}}
function editAccount(idx){
  const a=accounts[idx];
  const modal=document.getElementById("modal"); const card=document.getElementById("modal-card");
  card.innerHTML=`<h3>ìˆ˜ì •</h3>
  <input type="number" id="ac-price" value="${a.price}">
  <input type="text" id="ac-store" value="${a.store}">
  <input type="date" id="ac-date" value="${a.date}">
  <input type="text" id="ac-model" value="${a.model}">
  <input type="text" id="ac-brand" value="${a.brand}">
  <textarea id="ac-note">${a.note}</textarea>
  <div style="display:flex;gap:8px;margin-top:8px;"><button class="btn" onclick="saveAccountEdit(${idx})">ì €ì¥</button>
  <button class="btn ghost" onclick="closeModal()">ì·¨ì†Œ</button></div>`;
  modal.style.display="flex";
}
function saveAccountEdit(idx){
  const price=Number(document.getElementById("ac-price").value);
  const store=document.getElementById("ac-store").value;
  const date=document.getElementById("ac-date").value;
  const model=document.getElementById("ac-model").value;
  const brand=document.getElementById("ac-brand").value;
  const note=document.getElementById("ac-note").value;
  if(!price||!date){alert("ê°€ê²©ê³¼ ë‚ ì§œ í•„ìˆ˜"); return;}
  accounts[idx]={...accounts[idx],price,store,date,model,brand,note};
  saveAccounts();closeModal();renderAccount();
}
function showAccountByType(type){const historyWrap=document.getElementById("account-history");historyWrap.innerHTML=""; accounts.filter(a=>a.type===type).forEach((a,idx)=>{ const item=document.createElement("div"); item.className="sq account-item"; item.innerHTML=`<div><b>${a.type==="expense"?"ì§€ì¶œ":"ìˆ˜ì…"}</b> - ${a.brand||""} ${a.model||""} : ${a.price}ì›</div>`; historyWrap.appendChild(item);});}
function prevMonth(){currentMonth--; if(currentMonth<0){currentMonth=11; currentYear--;} renderAccount();}
function nextMonth(){currentMonth++; if(currentMonth>11){currentMonth=0; currentYear++;} renderAccount();}

// ===== ë¸Œëœë“œ/ì‹œê³„ ê²€ìƒ‰ & ì¶”ê°€ í•€ì¹˜ì¤Œ ë°©ì§€ =====
document.addEventListener('gesturestart', function (e) { e.preventDefault(); });
</script>
</div>
</body>
</html>