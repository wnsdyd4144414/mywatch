<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, user-scalable=no, maximum-scale=1">
<title>MyWatch</title>

<style>
/* ====== CSS ì „ì²´ ============================= */

body {
    margin: 0;
    padding: 0;
    background: #111;
    color: white;
    font-family: 'Pretendard', sans-serif;
    overflow-x: hidden;
    touch-action: manipulation;
}

.page { display: none; }
.page.active { display: block; }

.container { padding: 20px; }

.square {
    background: rgba(255,255,255,0.05);
    border-radius: 16px;
    padding: 20px;
    margin: 15px 0;
    backdrop-filter: blur(12px);
    border: 1px solid rgba(255,255,255,0.1);
    box-shadow:
        inset 2px 2px 4px rgba(255,255,255,0.07),
        inset -2px -2px 4px rgba(0,0,0,0.4),
        4px 4px 8px rgba(0,0,0,0.4);
}

input, textarea {
    width: 100%;
    padding: 14px;
    margin: 10px 0;
    background: rgba(255,255,255,0.07);
    border: 1px solid rgba(255,255,255,0.15);
    border-radius: 12px;
    color: white;
    font-size: 15px;
}

button {
    padding: 12px 16px;
    background: rgba(255,255,255,0.1);
    border: none;
    color: white;
    border-radius: 12px;
    font-size: 15px;
    cursor: pointer;
    transition: 0.15s;
}

button:active {
    transform: scale(0.95);
    background: rgba(255,255,255,0.25);
}

.backBtn {
    position: fixed;
    top: 20px;
    left: 20px;
    background: rgba(255,255,255,0.15);
    padding: 10px 14px;
    border-radius: 10px;
    z-index: 100;
}

.topRightBtn {
    position: fixed;
    top: 20px;
    right: 20px;
    padding: 10px 14px;
    background: rgba(255,255,255,0.15);
    border-radius: 10px;
    z-index: 100;
}

.floatingBtn {
    position: fixed;
    right: 20px;
    bottom: 30px;
    width: 65px;
    height: 65px;
    border-radius: 20px;
    background: rgba(255,255,255,0.15);
    font-size: 40px;
    text-align: center;
    line-height: 57px;
    backdrop-filter: blur(10px);
}

.listItem {
    padding: 12px;
    border-bottom: 1px solid rgba(255,255,255,0.15);
    display: flex;
    justify-content: space-between;
}

.scrollArea {
    max-height: 300px;
    overflow-y: auto;
    padding-right: 8px;
}

.spend { color:#ff6666; }
.income { color:#66cfff; }
</style>
</head>


<body>

<!-- ======================= í™ˆ ============================= -->
<div id="homePage" class="page active">
    <button class="topRightBtn" onclick="openPage('accountPage')">ğŸ’°</button>
    <button class="backBtn" onclick="location.reload()">âŸ³</button>

    <div class="container" style="margin-top:70px;">
        <h1>MyWatch</h1>
        <div>created by jjun</div>

        <!-- ë¸Œëœë“œ ê²€ìƒ‰ -->
        <input id="brandSearch" placeholder="ë¸Œëœë“œ ê²€ìƒ‰..." oninput="renderBrandList()">

        <!-- ë¸Œëœë“œ ë¦¬ìŠ¤íŠ¸ -->
        <div id="brandList" class="square"></div>

        <!-- ì‹œê³„ ê²€ìƒ‰ -->
        <input id="watchSearch" placeholder="ì‹œê³„ ê²€ìƒ‰..." oninput="renderWatchList()">

        <!-- ì‹œê³„ ë¦¬ìŠ¤íŠ¸ -->
        <div id="watchList" class="square"></div>
    </div>

    <button class="floatingBtn" onclick="openAddWatchPage()">ï¼‹</button>
</div>




<!-- ======================= ì‹œê³„ ì¶”ê°€ ====================== -->
<div id="addWatchPage" class="page">
    <button class="backBtn" onclick="openPage('homePage')">â†</button>

    <div class="container" style="margin-top:70px;">
        <h2>ì‹œê³„ ì¶”ê°€</h2>

        <input id="watchBrand" placeholder="ë¸Œëœë“œ">
        <input id="watchModel" placeholder="ëª¨ë¸ëª…">
        <input id="watchPrice" type="number" placeholder="ê°€ê²©">
        <input id="watchYear" type="number" placeholder="êµ¬ë§¤ë…„ë„ (ì„ íƒ)">
        <textarea id="watchMemo" placeholder="ë©”ëª¨"></textarea>

        <button onclick="addWatch()">ì¶”ê°€</button>
    </div>
</div>




<!-- ======================= ë¸Œëœë“œ ì¶”ê°€ ==================== -->
<div id="addBrandPage" class="page">
    <button class="backBtn" onclick="openPage('homePage')">â†</button>

    <div class="container" style="margin-top:70px;">
        <h2>ë¸Œëœë“œ ì¶”ê°€</h2>

        <input id="brandName" placeholder="ë¸Œëœë“œëª… ì…ë ¥">

        <button onclick="addBrand()">ì¶”ê°€</button>
    </div>
</div>



<!-- ======================= ê°€ê³„ë¶€ íŒì—… ==================== -->
<div id="accountPopup" class="page" 
     style="position:fixed; top:0; left:0; width:100%; height:100%;
            background:rgba(0,0,0,0.6); backdrop-filter:blur(8px); display:none;">
    <div class="container" style="margin-top:120px;">
        <div class="square" style="text-align:center;">
            <h2>í•­ëª© ì„ íƒ</h2>
            <button onclick="openAddSpendPage()" style="width:100%; margin-top:20px;">êµ¬ë§¤ (ì§€ì¶œ)</button>
            <button onclick="openAddIncomePage()" style="width:100%; margin-top:12px;">íŒë§¤ (ìˆ˜ì…)</button>
            <button onclick="closeAccountPopup()" style="margin-top:20px;">ë‹«ê¸°</button>
        </div>
    </div>
</div>



<!-- ======================= ì§€ì¶œ ì…ë ¥ ====================== -->
<div id="addSpendPage" class="page">
    <button class="backBtn" onclick="closeSpendIncomePage()">â†</button>

    <div class="container" style="margin-top:70px;">
        <h2>ì§€ì¶œ ì¶”ê°€</h2>

        <input id="spendPrice" type="number" placeholder="ê°€ê²©">
        <input id="spendPlace" placeholder="êµ¬ë§¤ì²˜">
        <input id="spendDate" type="date">
        <input id="spendModel" placeholder="ëª¨ë¸ëª…">
        <input id="spendBrand" placeholder="ë¸Œëœë“œ">
        <textarea id="spendMemo" placeholder="êµ¬ë§¤ ì´ìœ "></textarea>

        <button onclick="addSpend()">ì¶”ê°€</button>
    </div>
</div>



<!-- ======================= ìˆ˜ì… ì…ë ¥ ====================== -->
<div id="addIncomePage" class="page">
    <button class="backBtn" onclick="closeSpendIncomePage()">â†</button>

    <div class="container" style="margin-top:70px;">
        <h2>ìˆ˜ì… ì¶”ê°€</h2>

        <input id="incomePrice" type="number" placeholder="ê°€ê²©">
        <input id="incomePlace" placeholder="íŒë§¤ì²˜">
        <input id="incomeDate" type="date">
        <input id="incomeModel" placeholder="ëª¨ë¸ëª…">
        <input id="incomeBrand" placeholder="ë¸Œëœë“œ">
        <textarea id="incomeMemo" placeholder="íŒë§¤ ì´ìœ "></textarea>

        <button onclick="addIncome()">ì¶”ê°€</button>
    </div>
</div>



<!-- ======================= ê°€ê³„ë¶€ ë©”ì¸ ==================== -->
<div id="accountPage" class="page">
    <button class="backBtn" onclick="openPage('homePage')">â†</button>

    <div class="container" style="margin-top:70px;">

        <div class="square" style="text-align:center;">
            <button onclick="prevMonth()">â†</button>
            <span id="accountMonthText" style="margin:0 20px; font-size:20px;"></span>
            <button onclick="nextMonth()">â†’</button>
        </div>

        <div class="square" style="text-align:center;">
            <h3>ì´ë²ˆë‹¬ ì´ ì‚¬ìš© ê¸ˆì•¡</h3>
            <div id="monthTotal" style="font-size:22px; margin-top:10px;">0ì›</div>
        </div>

        <div class="square" id="weekdayTotals"></div>

        <div id="accountList" class="square scrollArea"></div>

        <div class="square" style="margin-top:20px;">
            <h3>ìµœì¢… í•©ê³„</h3>
            ì§€ì¶œ: <span id="totalSpend" class="spend">0</span>ì›<br>
            ìˆ˜ì…: <span id="totalIncome" class="income">0</span>ì›<br><br>
            <div style="font-size:22px;">
                ìµœì¢…: <span id="totalResult">0</span>ì›
            </div><br>
            <button onclick="openSpendList()" class="spend">ì§€ì¶œ ë‚´ì—­</button>
            <button onclick="openIncomeList()" class="income">ìˆ˜ì… ë‚´ì—­</button>
        </div>

    </div>

    <button class="floatingBtn" onclick="openAccountAddPopup()">ï¼‹</button>
</div>


<!-- ======================= ê°€ê³„ë¶€ ìˆ˜ì • ==================== -->
<div id="editAccountPage" class="page">
    <button class="backBtn" onclick="openPage('accountPage')">â†</button>

    <div class="container" style="margin-top:70px;">
        <h2 id="editAccountTitle">ìˆ˜ì •</h2>

        <input id="editAccountPrice">
        <input id="editAccountPlace">
        <input id="editAccountDate" type="date">
        <input id="editAccountModel">
        <input id="editAccountBrand">
        <textarea id="editAccountMemo"></textarea>

        <button onclick="saveEditedAccount()">ì €ì¥</button>
        <button onclick="deleteAccount()" style="background:#ff4444; margin-top:10px;">ì‚­ì œ</button>
    </div>
</div>

  <script>
/* ============================================================
    ê¸°ë³¸ í˜ì´ì§€ ì „í™˜
============================================================ */
function openPage(id) {
    document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
    document.getElementById(id).classList.add('active');
}



/* ============================================================
    ë¡œì»¬ìŠ¤í† ë¦¬ì§€ ë°ì´í„°
============================================================ */
let brands = JSON.parse(localStorage.getItem("brands") || "[]");
let watches = JSON.parse(localStorage.getItem("watches") || "[]");
let account = JSON.parse(localStorage.getItem("account") || "[]");

function saveData() {
    localStorage.setItem("brands", JSON.stringify(brands));
    localStorage.setItem("watches", JSON.stringify(watches));
    localStorage.setItem("account", JSON.stringify(account));
}



/* ============================================================
    ë¸Œëœë“œ
============================================================ */
function renderBrandList() {
    const keyword = document.getElementById("brandSearch").value.toLowerCase();
    const box = document.getElementById("brandList");

    const list = brands
        .filter(b => b.toLowerCase().includes(keyword))
        .map(brand => {
            const count = watches.filter(w => w.brand === brand).length;
            return `
                <div class="listItem">
                    <span>${brand} (${count}ê°œ)</span>
                    <button onclick="deleteBrand('${brand}')">ì‚­ì œ</button>
                </div>
            `;
        }).join("");

    box.innerHTML = list || "ë¸Œëœë“œ ì—†ìŒ";
}

function addBrand() {
    const name = document.getElementById("brandName").value.trim();
    if (!name) return alert("ë¸Œëœë“œëª…ì„ ì…ë ¥í•˜ì„¸ìš”.");

    brands.push(name);
    saveData();
    openPage("homePage");
    renderBrandList();
}

function deleteBrand(name) {
    if (!confirm("í•´ë‹¹ ë¸Œëœë“œë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) return;
    brands = brands.filter(b => b !== name);

    // ê·¸ ë¸Œëœë“œ ì‹œê³„ë„ ì‚­ì œ
    watches = watches.filter(w => w.brand !== name);

    saveData();
    renderBrandList();
    renderWatchList();
}



/* ============================================================
    ì‹œê³„
============================================================ */
function renderWatchList() {
    const keyword = document.getElementById("watchSearch").value.toLowerCase();
    const box = document.getElementById("watchList");

    const list = watches
        .filter(w => 
            w.brand.toLowerCase().includes(keyword) ||
            w.model.toLowerCase().includes(keyword)
        )
        .map(w => `
            <div class="listItem">
                <span>${w.brand} - ${w.model}</span>
                <button onclick="editWatch('${w.id}')">ìˆ˜ì •</button>
            </div>
        `).join("");

    box.innerHTML = list || "ì‹œê³„ ì—†ìŒ";
}

function openAddWatchPage() {
    openPage("addWatchPage");
}

function addWatch() {
    const brand = document.getElementById("watchBrand").value.trim();
    const model = document.getElementById("watchModel").value.trim();
    const price = document.getElementById("watchPrice").value;
    const year = document.getElementById("watchYear").value;
    const memo = document.getElementById("watchMemo").value;

    if (!brand || !model) return alert("ë¸Œëœë“œì™€ ëª¨ë¸ëª…ì€ í•„ìˆ˜ì…ë‹ˆë‹¤.");

    if (!brands.includes(brand)) brands.push(brand);

    watches.push({
        id: String(Date.now()),
        brand,
        model,
        price,
        year,
        memo
    });

    saveData();
    openPage("homePage");
    renderBrandList();
    renderWatchList();
}



/* ============================================================
    ê°€ê³„ë¶€ â€” ê³µí†µ
============================================================ */
let currentMonth = new Date();

function updateMonthText() {
    const y = currentMonth.getFullYear();
    const m = currentMonth.getMonth() + 1;
    document.getElementById("accountMonthText").innerText = `${y}ë…„ ${m}ì›”`;

    renderAccountList();
}

function prevMonth() {
    currentMonth.setMonth(currentMonth.getMonth() - 1);
    updateMonthText();
}

function nextMonth() {
    currentMonth.setMonth(currentMonth.getMonth() + 1);
    updateMonthText();
}



/* ============================================================
    ê°€ê³„ë¶€ â€” ë©”ì¸ ë¦¬ìŠ¤íŠ¸ ë Œë”ë§
============================================================ */
function renderAccountList() {
    const y = currentMonth.getFullYear();
    const m = currentMonth.getMonth() + 1;

    const listBox = document.getElementById("accountList");

    const filtered = account.filter(a => {
        const d = new Date(a.date);
        return d.getFullYear() === y && (d.getMonth() + 1) === m;
    });

    listBox.innerHTML = filtered.map(a => `
        <div class="listItem">
            <span>${a.type === "spend" ? "ì§€ì¶œ" : "ìˆ˜ì…"} â€” ${a.model}</span>
            <button onclick="openEditAccount('${a.id}')">ìˆ˜ì •</button>
        </div>
    `).join("") || "ë‚´ì—­ ì—†ìŒ";

    updateTotals();
    renderWeekdayTotals();
}



/* ============================================================
    ê°€ê³„ë¶€ â€” ì£¼ê°„ í•©ê³„
============================================================ */
function renderWeekdayTotals() {
    const y = currentMonth.getFullYear();
    const m = currentMonth.getMonth() + 1;

    const weekdaySum = [0,0,0,0,0,0,0];

    account.forEach(a => {
        const d = new Date(a.date);
        if (d.getFullYear() === y && d.getMonth()+1 === m) {
            const wd = d.getDay();
            weekdaySum[wd] += (a.type === "spend" ? -a.price : a.price);
        }
    });

    const names = ["ì¼","ì›”","í™”","ìˆ˜","ëª©","ê¸ˆ","í† "];

    document.getElementById("weekdayTotals").innerHTML = 
        names.map((n,i)=> `${n}: ${weekdaySum[i]}ì›`).join("<br>");
}



/* ============================================================
    ê°€ê³„ë¶€ â€” ìµœì¢… ê¸ˆì•¡
============================================================ */
function updateTotals() {
    let spend = 0;
    let income = 0;

    account.forEach(a => {
        if (a.type === "spend") spend += a.price;
        else income += a.price;
    });

    const result = income - spend;

    document.getElementById("totalSpend").innerText = spend;
    document.getElementById("totalIncome").innerText = income;
    document.getElementById("totalResult").innerText = result;
}



/* ============================================================
    ê°€ê³„ë¶€ â€” íŒì—…
============================================================ */
function openAccountAddPopup() {
    document.getElementById("accountPopup").style.display = "block";
}

function closeAccountPopup() {
    document.getElementById("accountPopup").style.display = "none";
}

function openAddSpendPage() {
    closeAccountPopup();
    openPage("addSpendPage");
}

function openAddIncomePage() {
    closeAccountPopup();
    openPage("addIncomePage");
}

function closeSpendIncomePage() {
    openPage("accountPage");
}



/* ============================================================
    ì§€ì¶œ ì¶”ê°€
============================================================ */
function addSpend() {
    const price = Number(document.getElementById("spendPrice").value || 0);
    const place = document.getElementById("spendPlace").value;
    const date = document.getElementById("spendDate").value;
    const model = document.getElementById("spendModel").value;
    const brand = document.getElementById("spendBrand").value;
    const memo = document.getElementById("spendMemo").value;

    if (!price || !date) return alert("ê°€ê²©ê³¼ ë‚ ì§œëŠ” í•„ìˆ˜ì…ë‹ˆë‹¤.");

    account.push({
        id: String(Date.now()),
        type: "spend",
        price,
        place,
        date,
        model,
        brand,
        memo
    });

    saveData();
    openPage("accountPage");
    renderAccountList();
}



/* ============================================================
    ìˆ˜ì… ì¶”ê°€
============================================================ */
function addIncome() {
    const price = Number(document.getElementById("incomePrice").value || 0);
    const place = document.getElementById("incomePlace").value;
    const date = document.getElementById("incomeDate").value;
    const model = document.getElementById("incomeModel").value;
    const brand = document.getElementById("incomeBrand").value;
    const memo = document.getElementById("incomeMemo").value;

    if (!price || !date) return alert("ê°€ê²©ê³¼ ë‚ ì§œëŠ” í•„ìˆ˜ì…ë‹ˆë‹¤.");

    account.push({
        id: String(Date.now()),
        type: "income",
        price,
        place,
        date,
        model,
        brand,
        memo
    });

    saveData();
    openPage("accountPage");
    renderAccountList();
}



/* ============================================================
    ê°€ê³„ë¶€ â€” ìˆ˜ì •
============================================================ */
let editTargetId = null;

function openEditAccount(id) {
    const item = account.find(a => a.id === id);
    if (!item) return;

    editTargetId = id;

    document.getElementById("editAccountTitle").innerText =
        item.type === "spend" ? "ì§€ì¶œ ìˆ˜ì •" : "ìˆ˜ì… ìˆ˜ì •";

    document.getElementById("editAccountPrice").value = item.price;
    document.getElementById("editAccountPlace").value = item.place;
    document.getElementById("editAccountDate").value = item.date;
    document.getElementById("editAccountModel").value = item.model;
    document.getElementById("editAccountBrand").value = item.brand;
    document.getElementById("editAccountMemo").value = item.memo;

    openPage("editAccountPage");
}

function saveEditedAccount() {
    const item = account.find(a => a.id === editTargetId);
    if (!item) return;

    item.price = Number(document.getElementById("editAccountPrice").value || 0);
    item.place = document.getElementById("editAccountPlace").value;
    item.date = document.getElementById("editAccountDate").value;
    item.model = document.getElementById("editAccountModel").value;
    item.brand = document.getElementById("editAccountBrand").value;
    item.memo = document.getElementById("editAccountMemo").value;

    saveData();
    openPage("accountPage");
    renderAccountList();
}

function deleteAccount() {
    if (!confirm("ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) return;

    account = account.filter(a => a.id !== editTargetId);
    saveData();

    openPage("accountPage");
    renderAccountList();
}



/* ============================================================
    ì´ˆê¸° ë Œë”ë§
============================================================ */
renderBrandList();
renderWatchList();
updateMonthText();
</script>
